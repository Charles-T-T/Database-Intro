# 实验五 安全性和完整性实验

## 实验目的

- 掌握通过SQL语句进行权限管理的方法
- 理解不同类型触发器的作用和原理，验证触发器的有效性

## 实验内容和要求

### 安全性实验

- 在DBMS上尝试教科书第四章例子。建立多个用户，在权限发生变化时，尝试登录，观察结果。使用华为云平台的同学可以多人合作来完成实验。

- 在DBMS上尝试下面的实验，并分析原因：A、B和C为用户。x为某权限，比如在某表上的 `select` 。

  - A--x-->B--x-->C

    收回B的x

    C是否还具有x? `cascade` 是否有效？

  - A--x-->B--x-->C

    A--x-->C

    收回B的x，C是否还有x？

    收回C的x，是否需要指定权限来源？

  - 尝试分析原因

### 触发器实验

> [!NOTE] 
>
> 本实验基于Northwind数据库，个人独立完成。
>
> 注意，在金仓数据库中，不支持 `referencing` 关键词。可以直接用 `old` 和 `new` 来得到更改前后的行。

首先，在orders表中，插入一列，TotalPrice，含义为该订单的总价。使用 `Update` 语句为每个订单填入总价。

接下来，解决下面的问题：

- 在order_details表上定义一个 `UPDATE` 触发器，当修改订单明细（quantity, discount）时，自动修改订单Orders的TotalPrice，以保持数据一致性。
- 在order_details表上定义一个 `INSERT` 触发器，当增加一项订单明细时，自动修改订单Orders的TotalPrice，以保持数据一致性。假设增加订单明细项时，对应订单已经存在。